<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fun Periodic Table & Reaction Playground</title>
    <style>
        /* --- Global Styles --- */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            text-align: center;
            overflow-x: hidden;
        }

        .container {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 95%;
            max-width: 1200px;
        }

        button {
            background: #ff6b6b;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 10px;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        button:hover {
            background: #ee5253;
            transform: scale(1.05);
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .hidden { display: none !important; }

        /* --- User Profile Section --- */
        #user-profile { padding: 30px; }
        #user-profile h1 { font-size: 2.5em; margin-bottom: 20px; color: #f0f0f0; }
        #user-profile label { display: block; font-size: 1.2em; margin-top: 15px; color: #ddd; }
        #user-profile input[type="text"],
        #user-profile input[type="number"] {
            width: calc(100% - 22px); padding: 10px; margin-top: 5px; border: 1px solid #ccc;
            border-radius: 5px; background-color: rgba(255, 255, 255, 0.8); color: #333;
        }
        #user-profile button { font-size: 1.2em; padding: 12px 25px; margin-top: 25px; }

        /* --- Periodic Table Section --- */
        #periodic-table-section { padding-bottom: 20px; }
        #periodic-table-section h2 { font-size: 2em; margin-bottom: 10px; }
        #greeting { font-size: 1.2em; margin-bottom: 20px; }
        .periodic-table {
            display: grid; grid-template-columns: repeat(18, 1fr); gap: 4px;
            margin-top: 20px; max-width: 100%; overflow-x: auto; padding-bottom: 10px;
        }
        .element {
            padding: 4px; border-radius: 6px; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            min-height: 55px; font-size: 0.6em; box-shadow: 0 1px 3px rgba(0,0,0,0.2); line-height: 1.1;
        }
        .element:hover { transform: scale(1.15); box-shadow: 0 4px 10px rgba(0,0,0,0.3); z-index: 10; position: relative; }
        .element .symbol { font-size: 1.4em; font-weight: bold; margin-bottom: 1px; }
        .element .atomic-number { font-size: 0.8em; align-self: flex-start; margin-left: 2px; margin-top: -2px; opacity: 0.7; }
        .element .name { font-size: 0.75em; margin-top: 1px; word-break: break-all; }
        
        .alkali-metal { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); color: #502424; }
        .alkaline-earth-metal { background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); color: #5d3a0b; }
        .lanthanide { background: linear-gradient(135deg, #c3cfe2 0%, #c3cfe2 100%); color: #313a47; }
        .actinide { background: linear-gradient(135deg, #e6dee9 0%, #bdc2c7 100%); color: #413c45; }
        .transition-metal { background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%); color: #1c3d59; }
        .post-transition-metal { background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%); color: #2a5019; }
        .metalloid { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); color: #1c4e44; }
        .nonmetal { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #412036; }
        .halogen { background: linear-gradient(135deg, #fccb90 0%, #d57eeb 100%); color: #592e0d; }
        .noble-gas { background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%); color: #332e59; }
        .unknown { background: linear-gradient(135deg, #b0bec5 0%, #eceff1 100%); color: #3747f; }

        /* --- Element Details Modal --- */
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; background-color: rgba(0,0,0,0.7); justify-content: center; align-items: center;
        }
        .modal-content {
            background: linear-gradient(135deg, #4a4e69 0%, #2b2d42 100%); color: #fff; margin: auto;
            padding: 30px; border-radius: 10px; width: 80%; max-width: 500px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.4); animation: slideIn 0.4s ease-out;
        }
        @keyframes slideIn { from {transform: translateY(-50px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }
        .close-button { color: #e0e0e0; float: right; font-size: 32px; font-weight: bold; cursor: pointer; transition: color 0.2s; }
        .close-button:hover, .close-button:focus { color: #ff6b6b; text-decoration: none; }
        #element-details-content h3 { margin-top: 0; color: #f0f0f0; border-bottom: 2px solid #ff6b6b; padding-bottom: 10px; }
        #element-details-content p { line-height: 1.6; font-size: 1.1em; }
        #element-details-content p strong { color: #ffcb90; } 

        .empty-cell { visibility: hidden; min-height: 55px; }
        .series-label { grid-column: span 2; display: flex; align-items: center; justify-content: flex-end; font-size: 0.8em; padding-right: 5px; color: #e0e0e0;}

        /* --- Reaction Playground Styles --- */
        #reaction-playground { padding: 20px; }
        #reaction-playground h2 { font-size: 2em; margin-bottom: 20px; }
        .playground-area {
            display: flex; justify-content: space-around; align-items: flex-start;
            flex-wrap: wrap; gap: 20px; margin-bottom: 20px;
        }
        #playground-elements-container {
            border: 2px dashed #a1c4fd; padding: 15px; border-radius: 10px;
            max-height: 300px; 
            min-height: 150px; width: 280px; 
            display: flex; flex-wrap: wrap; gap: 8px; 
            justify-content: center; align-content: flex-start;
            overflow-y: auto; background-color: rgba(0,0,0,0.1);
        }
        #playground-elements-container h3, #reaction-chamber-container h3 {
            width: 100%; text-align: center; margin-bottom: 10px; font-size: 1.2em; color: #e0e0e0;
        }
        .draggable-element { 
            width: 55px; height: 55px; 
            border-radius: 6px; display: flex;
            flex-direction: column; justify-content: center; align-items: center;
            font-size: 0.8em; 
            cursor: grab; user-select: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            border: 2px solid transparent;
            transition: border-color 0.2s ease, transform 0.2s ease;
        }
        .draggable-element.selected-for-reaction {
            border-color: #84fab0; transform: scale(1.1);
            box-shadow: 0 4px 10px rgba(132, 250, 176, 0.5);
        }
        .draggable-element .symbol { font-size: 1.3em; font-weight: bold; } 
        .draggable-element .name { font-size: 0.7em; } 

        #reaction-chamber-container {
            border: 2px solid #f6d365; padding: 15px; border-radius: 10px;
            width: 350px; min-height: 150px; background-color: rgba(0,0,0,0.1);
        }
        .drop-zones { display: flex; justify-content: space-around; margin-bottom: 15px; gap: 10px; }
        .drop-zone {
            width: 100px; height: 100px; border: 2px dashed #ccc; border-radius: 8px;
            display: flex; justify-content: center; align-items: center;
            background-color: rgba(255,255,255,0.05);
            transition: background-color 0.3s ease, border-color 0.3s ease;
            cursor: pointer;
        }
        .drop-zone.drag-over { background-color: rgba(255,255,255,0.2); border-style: solid; }
        .drop-zone.can-place { border-color: #84fab0; }
        .drop-zone .element-placeholder { font-size: 0.9em; color: #aaa; }
        .drop-zone .draggable-element { cursor: default; border-color: transparent !important; transform: scale(1) !important; }

        #combine-button { background: #84fab0; color: #1c4e44; font-weight: bold; padding: 12px 25px; font-size: 1.1em; }
        #combine-button:hover { background: #70e098; }

        #reaction-result { margin-top: 20px; font-size: 1.2em; font-weight: bold; min-height: 50px; padding: 10px; border-radius: 8px; line-height: 1.4; }
        
        #reaction-result.product-animation { 
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); 
            color: #333; 
            display: inline-block; padding: 10px 15px; 
        }
        #reaction-result.product-animation .clickable-product {
            cursor: pointer;
            text-decoration: underline;
            color: #764ba2; 
            font-weight: bold;
        }
        #reaction-result.product-animation .clickable-product:hover {
            color: #667eea; 
        }
        #reaction-result.product-animation p { 
            font-size: 0.8em !important; 
            color: #4a4e69; 
            opacity: 1; 
            margin-top: 5px;
        }

        @keyframes productAppear { 0% { transform: scale(0.5) rotate(-15deg); opacity: 0; } 70% { transform: scale(1.1) rotate(5deg); opacity: 1; } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
        .reaction-error { color: #ff6b6b; animation: shake 0.5s ease-in-out; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
   
        /* --- Quiz Section Styles --- */
        #quiz-section { padding: 20px; }
        #quiz-section h2 { font-size: 2em; margin-bottom: 20px; }
        #quiz-greeting { font-size: 1.2em; margin-bottom: 15px; }
        #quiz-area {
            background-color: rgba(0,0,0,0.15);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        #question-container { margin-bottom: 20px; }
        #question-text { font-size: 1.3em; margin-bottom: 15px; color: #f0f0f0; }
        #options-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        .option-button {
            background-color: #4a4e69;
            color: white;
            padding: 12px 15px;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s, border-color 0.3s;
        }
        .option-button:hover { background-color: #606582; }
        .option-button.selected { border-color: #84fab0; background-color: #5c8d77; }
        .option-button.correct { background-color: #84fab0; color: #1c4e44; border-color: #1c4e44;}
        .option-button.incorrect { background-color: #ff6b6b; color: white; border-color: #ee5253;}

        #feedback-text { font-size: 1.1em; margin-top: 10px; min-height: 25px; }
        #score-container { margin-top: 20px; font-size: 1.2em; }
        #quiz-results-area { margin-top: 20px; padding: 15px; background-color: rgba(0,0,0,0.2); border-radius: 8px;}
        #quiz-results-area h3 {font-size: 1.8em; color: #84fab0;}
        #quiz-results-area p {font-size: 1.2em;}
        #start-quiz-button, #submit-answer-button, #next-question-button, #play-again-button, #back-to-main-from-quiz {
             background: #84fab0; color: #1c4e44; font-weight: bold;
        }
        #start-quiz-button:hover, #submit-answer-button:hover, #next-question-button:hover, #play-again-button:hover, #back-to-main-from-quiz:hover {
            background: #70e098;
        }
        #back-to-main-from-quiz { margin-top: 25px; background: #ff6b6b;}
        #back-to-main-from-quiz:hover { background: #ee5253;}
    </style>
</head>
<body>
    <div class="container">
        <section id="user-profile">
            <h1>🧪 Periodic Table Adventure! 🧪</h1>
            <label for="user-name">Your Name:</label>
            <input type="text" id="user-name" placeholder="e.g., Priya">
            <label for="user-age">Your Age:</label>
            <input type="number" id="user-age" placeholder="e.g., 10">
            <button id="start-learning">Start Learning!</button>
        </section>

        <section id="periodic-table-section" class="hidden">
            <div id="greeting"></div>
            <h2>Periodic Table</h2>
            <button id="goto-playground-button">Go to Reaction Playground</button>
            <button id="goto-quiz-button" style="background: #f6d365; color: #5d3a0b; margin-left:10px;">Go to Quiz</button>
            <div class="periodic-table" id="periodic-table-grid"></div>
        </section>

        <section id="reaction-playground" class="hidden">
            <h2>Reaction Playground</h2>
            <button id="back-to-table-button">Back to Periodic Table</button>
            <div class="playground-area">
                <div id="playground-elements-container">
                    <h3>Tap to Select Element</h3>
                    </div>
                <div id="reaction-chamber-container">
                    <h3>Tap Zone to Place Element</h3>
                    <div class="drop-zones">
                        <div id="drop-zone-1" class="drop-zone" data-zone-id="1"><span class="element-placeholder">Zone 1</span></div>
                        <div id="drop-zone-2" class="drop-zone" data-zone-id="2"><span class="element-placeholder">Zone 2</span></div>
                    </div>
                    <button id="combine-button">Combine!</button>
                </div>
            </div>
            <div id="reaction-result"></div>
            <p style="font-size: 0.9em; margin-top: 15px; color: #e0e0e0;">Note: This playground shows simplified common reactions. Real chemistry can be much more complex!</p>
        </section>

        <section id="quiz-section" class="hidden">
            <h2>Chemistry Quiz!</h2>
            <div id="quiz-greeting"></div>
            <div id="score-container">
                <p>Score: <span id="current-score">0</span></p>
            </div>
            <button id="start-quiz-button">Start Quiz</button>
            <div id="quiz-area" class="hidden">
                <div id="question-container">
                    <p id="question-text"></p>
                    <div id="options-container">
                        </div>
                </div>
                <button id="submit-answer-button">Submit Answer</button>
                <div id="feedback-text"></div>
                <button id="next-question-button" class="hidden">Next Question</button>
            </div>
            <div id="quiz-results-area" class="hidden">
                <h3>Quiz Finished!</h3>
                <p>Your final score: <span id="final-score">0</span> out of <span id="total-questions-answered">0</span></p>
                <button id="play-again-button">Play Again</button>
            </div>
            <button id="back-to-main-from-quiz">Back to Periodic Table</button>
        </section>
    </div>

    <div id="element-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="close-modal-button">&times;</span>
            <div id="element-details-content"></div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const userProfileSection = document.getElementById('user-profile');
        const periodicTableSection = document.getElementById('periodic-table-section');
        const reactionPlaygroundSection = document.getElementById('reaction-playground');
        const quizSection = document.getElementById('quiz-section'); 

        const startLearningButton = document.getElementById('start-learning');
        const userNameInput = document.getElementById('user-name');
        const userAgeInput = document.getElementById('user-age');
        const greetingDiv = document.getElementById('greeting');
        const periodicTableGrid = document.getElementById('periodic-table-grid');
        const elementModal = document.getElementById('element-modal');
        const closeModalButton = document.getElementById('close-modal-button');
        const elementDetailsContent = document.getElementById('element-details-content');
        
        const gotoPlaygroundButton = document.getElementById('goto-playground-button');
        const backToTableButton = document.getElementById('back-to-table-button');
        const playgroundElementsContainer = document.getElementById('playground-elements-container');
        const dropZone1 = document.getElementById('drop-zone-1');
        const dropZone2 = document.getElementById('drop-zone-2');
        const combineButton = document.getElementById('combine-button');
        const reactionResultDiv = document.getElementById('reaction-result');

        // Quiz DOM Elements
        const gotoQuizButton = document.getElementById('goto-quiz-button');
        const quizGreetingDiv = document.getElementById('quiz-greeting');
        const startQuizButton = document.getElementById('start-quiz-button');
        const quizAreaDiv = document.getElementById('quiz-area');
        const questionTextP = document.getElementById('question-text');
        const optionsContainerDiv = document.getElementById('options-container');
        const submitAnswerButton = document.getElementById('submit-answer-button');
        const feedbackTextDiv = document.getElementById('feedback-text');
        const nextQuestionButton = document.getElementById('next-question-button');
        const scoreSpan = document.getElementById('current-score');
        const quizResultsAreaDiv = document.getElementById('quiz-results-area');
        const finalScoreSpan = document.getElementById('final-score');
        const totalQuestionsAnsweredSpan = document.getElementById('total-questions-answered');
        const playAgainButton = document.getElementById('play-again-button');
        const backToMainFromQuizButton = document.getElementById('back-to-main-from-quiz');


        let currentUser = { name: '', age: 0 };
        let draggedElementDataForDesktop = null;
        let selectedPlaygroundElementData = null;
        let currentlySelectedVisualElement = null;

        // Quiz State Variables
        let currentQuizQuestions = [];
        let currentQuestionIndex = 0;
        let currentScore = 0;
        let selectedOptionButton = null;
        const QUESTIONS_PER_QUIZ = 5; 


        // --- FULL elementsData Array ---
        const elementsData = [
            { num: 1, sym: 'H', name: 'Hydrogen', cat: 'nonmetal', pos: [1,1], info_young: 'No. 1! Makes water!', info_older: 'Hydrogen (H, 1) is the lightest element, essential for stars and water.' },
            { num: 2, sym: 'He', name: 'Helium', cat: 'noble-gas', pos: [1,18], info_young: 'Floats balloons!', info_older: 'Helium (He, 2) is a noble gas, used in balloons and for cooling.' },
            { num: 3, sym: 'Li', name: 'Lithium', cat: 'alkali-metal', pos: [2,1], info_young: 'In batteries!', info_older: 'Lithium (Li, 3) is a reactive alkali metal used in batteries.' },
            { num: 4, sym: 'Be', name: 'Beryllium', cat: 'alkaline-earth-metal', pos: [2,2], info_young: 'Light & strong!', info_older: 'Beryllium (Be, 4) is a light but strong alkaline earth metal.' },
            { num: 5, sym: 'B', name: 'Boron', cat: 'metalloid', pos: [2,13], info_young: 'Helps plants grow.', info_older: 'Boron (B, 5) is a metalloid used in glass and cleaning products.' },
            { num: 6, sym: 'C', name: 'Carbon', cat: 'nonmetal', pos: [2,14], info_young: 'Basis of life!', info_older: 'Carbon (C, 6) is fundamental to life, forming diverse compounds.' },
            { num: 7, sym: 'N', name: 'Nitrogen', cat: 'nonmetal', pos: [2,15], info_young: 'In the air we breathe.', info_older: 'Nitrogen (N, 7) makes up most of Earth\'s atmosphere.' },
            { num: 8, sym: 'O', name: 'Oxygen', cat: 'nonmetal', pos: [2,16], info_young: 'We need it to live!', info_older: 'Oxygen (O, 8) is vital for respiration and combustion.' },
            { num: 9, sym: 'F', name: 'Fluorine', cat: 'halogen', pos: [2,17], info_young: 'Keeps teeth strong!', info_older: 'Fluorine (F, 9) is a highly reactive halogen, used in toothpaste.' },
            { num: 10, sym: 'Ne', name: 'Neon', cat: 'noble-gas', pos: [2,18], info_young: 'Glows in signs!', info_older: 'Neon (Ne, 10) is a noble gas used in bright advertising signs.' },
            { num: 11, sym: 'Na', name: 'Sodium', cat: 'alkali-metal', pos: [3,1], info_young: 'In table salt!', info_older: 'Sodium (Na, 11) is an alkali metal, a component of common salt.' },
            { num: 12, sym: 'Mg', name: 'Magnesium', cat: 'alkaline-earth-metal', pos: [3,2], info_young: 'Makes plants green.', info_older: 'Magnesium (Mg, 12) is an alkaline earth metal, important for chlorophyll.' },
            { num: 13, sym: 'Al', name: 'Aluminum', cat: 'post-transition-metal', pos: [3,13], info_young: 'For cans and foil!', info_older: 'Aluminum (Al, 13) is a lightweight metal used in many applications.' },
            { num: 14, sym: 'Si', name: 'Silicon', cat: 'metalloid', pos: [3,14], info_young: 'In computer chips!', info_older: 'Silicon (Si, 14) is a metalloid crucial for semiconductors.' },
            { num: 15, sym: 'P', name: 'Phosphorus', cat: 'nonmetal', pos: [3,15], info_young: 'Helps bones grow.', info_older: 'Phosphorus (P, 15) is essential for DNA, bones, and energy transfer.' },
            { num: 16, sym: 'S', name: 'Sulfur', cat: 'nonmetal', pos: [3,16], info_young: 'Can be smelly!', info_older: 'Sulfur (S, 16) is a nonmetal found in several compounds, some with strong odors.' },
            { num: 17, sym: 'Cl', name: 'Chlorine', cat: 'halogen', pos: [3,17], info_young: 'Cleans pool water.', info_older: 'Chlorine (Cl, 17) is a halogen used as a disinfectant and in plastics.' },
            { num: 18, sym: 'Ar', name: 'Argon', cat: 'noble-gas', pos: [3,18], info_young: 'In light bulbs.', info_older: 'Argon (Ar, 18) is a noble gas used in light bulbs and welding.' },
            { num: 19, sym: 'K', name: 'Potassium', cat: 'alkali-metal', pos: [4,1], info_young: 'Good in bananas!', info_older: 'Potassium (K, 19) is an alkali metal vital for nerve function and plants.' },
            { num: 20, sym: 'Ca', name: 'Calcium', cat: 'alkaline-earth-metal', pos: [4,2], info_young: 'Strong bones & teeth!', info_older: 'Calcium (Ca, 20) is crucial for bones, teeth, and muscle function.' },
            { num: 21, sym: 'Sc', name: 'Scandium', cat: 'transition-metal', pos: [4,3], info_young: 'Light but strong metal.', info_older: 'Scandium (Sc, 21) is a transition metal used in aerospace alloys.' },
            { num: 22, sym: 'Ti', name: 'Titanium', cat: 'transition-metal', pos: [4,4], info_young: 'Super strong metal!', info_older: 'Titanium (Ti, 22) is a strong, light, corrosion-resistant transition metal.' },
            { num: 23, sym: 'V', name: 'Vanadium', cat: 'transition-metal', pos: [4,5], info_young: 'Makes steel tough.', info_older: 'Vanadium (V, 23) is a transition metal used to strengthen steel.' },
            { num: 24, sym: 'Cr', name: 'Chromium', cat: 'transition-metal', pos: [4,6], info_young: 'Shiny like chrome!', info_older: 'Chromium (Cr, 24) is a transition metal used for chrome plating and stainless steel.' },
            { num: 25, sym: 'Mn', name: 'Manganese', cat: 'transition-metal', pos: [4,7], info_young: 'Important for health.', info_older: 'Manganese (Mn, 25) is a transition metal essential for enzymes and steel production.' },
            { num: 26, sym: 'Fe', name: 'Iron', cat: 'transition-metal', pos: [4,8], info_young: 'Makes steel! In blood.', info_older: 'Iron (Fe, 26) is a transition metal crucial for steel and carrying oxygen in blood.' },
            { num: 27, sym: 'Co', name: 'Cobalt', cat: 'transition-metal', pos: [4,9], info_young: 'Blue color! Magnets.', info_older: 'Cobalt (Co, 27) is a transition metal used in magnets, alloys, and pigments.' },
            { num: 28, sym: 'Ni', name: 'Nickel', cat: 'transition-metal', pos: [4,10], info_young: 'In coins and batteries.', info_older: 'Nickel (Ni, 28) is a transition metal used in coins, batteries, and stainless steel.' },
            { num: 29, sym: 'Cu', name: 'Copper', cat: 'transition-metal', pos: [4,11], info_young: 'For wires and pennies.', info_older: 'Copper (Cu, 29) is a transition metal known for electrical conductivity.' },
            { num: 30, sym: 'Zn', name: 'Zinc', cat: 'transition-metal', pos: [4,12], info_young: 'Helps you stay healthy.', info_older: 'Zinc (Zn, 30) is a transition metal used to galvanize steel and is an essential nutrient.' },
            { num: 31, sym: 'Ga', name: 'Gallium', cat: 'post-transition-metal', pos: [4,13], info_young: 'Melts in your hand!', info_older: 'Gallium (Ga, 31) is a post-transition metal that can melt at room temperature.' },
            { num: 32, sym: 'Ge', name: 'Germanium', cat: 'metalloid', pos: [4,14], info_young: 'In electronics.', info_older: 'Germanium (Ge, 32) is a metalloid used in semiconductors and fiber optics.' },
            { num: 33, sym: 'As', name: 'Arsenic', cat: 'metalloid', pos: [4,15], info_young: 'Sometimes a poison!', info_older: 'Arsenic (As, 33) is a metalloid, famously toxic but has some industrial uses.' },
            { num: 34, sym: 'Se', name: 'Selenium', cat: 'nonmetal', pos: [4,16], info_young: 'In shampoo! Good for you.', info_older: 'Selenium (Se, 34) is a nonmetal, an essential nutrient, used in some shampoos.' },
            { num: 35, sym: 'Br', name: 'Bromine', cat: 'halogen', pos: [4,17], info_young: 'Red liquid, strong smell.', info_older: 'Bromine (Br, 35) is a halogen, a fuming red-brown liquid at room temperature.' },
            { num: 36, sym: 'Kr', name: 'Krypton', cat: 'noble-gas', pos: [4,18], info_young: 'Like Superman\'s planet!', info_older: 'Krypton (Kr, 36) is a noble gas used in some types of lighting.' },
            { num: 37, sym: 'Rb', name: 'Rubidium', cat: 'alkali-metal', pos: [5,1], info_young: 'Very reactive metal.', info_older: 'Rubidium (Rb, 37) is a highly reactive alkali metal, used in atomic clocks.' },
            { num: 38, sym: 'Sr', name: 'Strontium', cat: 'alkaline-earth-metal', pos: [5,2], info_young: 'Red fireworks!', info_older: 'Strontium (Sr, 38) is an alkaline earth metal used for red color in fireworks.' },
            { num: 39, sym: 'Y', name: 'Yttrium', cat: 'transition-metal', pos: [5,3], info_young: 'Used in lasers.', info_older: 'Yttrium (Y, 39) is a transition metal used in lasers and superconductors.' },
            { num: 40, sym: 'Zr', name: 'Zirconium', cat: 'transition-metal', pos: [5,4], info_young: 'Strong, heat resistant.', info_older: 'Zirconium (Zr, 40) is a transition metal used in nuclear reactors and ceramics.' },
            { num: 41, sym: 'Nb', name: 'Niobium', cat: 'transition-metal', pos: [5,5], info_young: 'For strong steel alloys.', info_older: 'Niobium (Nb, 41) is a transition metal used in high-strength steel alloys.' },
            { num: 42, sym: 'Mo', name: 'Molybdenum', cat: 'transition-metal', pos: [5,6], info_young: 'Important for plants.', info_older: 'Molybdenum (Mo, 42) is a transition metal, an essential trace element for life.' },
            { num: 43, sym: 'Tc', name: 'Technetium', cat: 'transition-metal', pos: [5,7], info_young: 'Radioactive element.', info_older: 'Technetium (Tc, 43) is a radioactive transition metal, the lightest with no stable isotopes.' },
            { num: 44, sym: 'Ru', name: 'Ruthenium', cat: 'transition-metal', pos: [5,8], info_young: 'Rare and hard metal.', info_older: 'Ruthenium (Ru, 44) is a rare transition metal used in electronics and catalysts.' },
            { num: 45, sym: 'Rh', name: 'Rhodium', cat: 'transition-metal', pos: [5,9], info_young: 'Very expensive metal!', info_older: 'Rhodium (Rh, 45) is a rare, corrosion-resistant transition metal, very valuable.' },
            { num: 46, sym: 'Pd', name: 'Palladium', cat: 'transition-metal', pos: [5,10], info_young: 'Used in cars.', info_older: 'Palladium (Pd, 46) is a transition metal used in catalytic converters and jewelry.' },
            { num: 47, sym: 'Ag', name: 'Silver', cat: 'transition-metal', pos: [5,11], info_young: 'Shiny jewelry!', info_older: 'Silver (Ag, 47) is a precious transition metal known for its conductivity and use in jewelry.' },
            { num: 48, sym: 'Cd', name: 'Cadmium', cat: 'transition-metal', pos: [5,12], info_young: 'In some batteries.', info_older: 'Cadmium (Cd, 48) is a transition metal used in batteries and pigments, but is toxic.' },
            { num: 49, sym: 'In', name: 'Indium', cat: 'post-transition-metal', pos: [5,13], info_young: 'Soft, blueish metal.', info_older: 'Indium (In, 49) is a soft post-transition metal used in LCD screens.' },
            { num: 50, sym: 'Sn', name: 'Tin', cat: 'post-transition-metal', pos: [5,14], info_young: 'Tin cans! (not anymore)', info_older: 'Tin (Sn, 50) is a post-transition metal used in solder and coatings.' },
            { num: 51, sym: 'Sb', name: 'Antimony', cat: 'metalloid', pos: [5,15], info_young: 'Makes things flame resistant.', info_older: 'Antimony (Sb, 51) is a metalloid used in flame retardants and alloys.' },
            { num: 52, sym: 'Te', name: 'Tellurium', cat: 'metalloid', pos: [5,16], info_young: 'Used with other metals.', info_older: 'Tellurium (Te, 52) is a metalloid used in alloys and semiconductors.' },
            { num: 53, sym: 'I', name: 'Iodine', cat: 'halogen', pos: [5,17], info_young: 'Helps your thyroid.', info_older: 'Iodine (I, 53) is a halogen essential for thyroid hormones, also an antiseptic.' },
            { num: 54, sym: 'Xe', name: 'Xenon', cat: 'noble-gas', pos: [5,18], info_young: 'In bright headlights.', info_older: 'Xenon (Xe, 54) is a heavy noble gas used in specialized lights and anesthesia.' },
            { num: 55, sym: 'Cs', name: 'Cesium', cat: 'alkali-metal', pos: [6,1], info_young: 'Super reactive! Atomic clocks.', info_older: 'Cesium (Cs, 55) is a very reactive alkali metal used in atomic clocks.' },
            { num: 56, sym: 'Ba', name: 'Barium', cat: 'alkaline-earth-metal', pos: [6,2], info_young: 'Used for X-rays.', info_older: 'Barium (Ba, 56) is an alkaline earth metal used in medical imaging (barium meals).' },
            { num: 57, sym: 'La', name: 'Lanthanum', cat: 'lanthanide', pos: [6,3], info_young: 'Starts a special series!', info_older: 'Lanthanum (La, 57) is the first element of the lanthanide series.' },
            { num: 58, sym: 'Ce', name: 'Cerium', cat: 'lanthanide', pos: [8,3], info_young: 'Lanthanide group.', info_older: 'Cerium (Ce, 58) is a lanthanide, used in flints and glass polishing.' },
            { num: 59, sym: 'Pr', name: 'Praseodymium', cat: 'lanthanide', pos: [8,4], info_young: 'Lanthanide group.', info_older: 'Praseodymium (Pr, 59) is a lanthanide, used in magnets and yellow glass.' },
            { num: 60, sym: 'Nd', name: 'Neodymium', cat: 'lanthanide', pos: [8,5], info_young: 'Strong magnets!', info_older: 'Neodymium (Nd, 60) is a lanthanide, crucial for powerful magnets.' },
            { num: 61, sym: 'Pm', name: 'Promethium', cat: 'lanthanide', pos: [8,6], info_young: 'Radioactive lanthanide.', info_older: 'Promethium (Pm, 61) is a radioactive lanthanide, no stable isotopes.' },
            { num: 62, sym: 'Sm', name: 'Samarium', cat: 'lanthanide', pos: [8,7], info_young: 'Lanthanide group.', info_older: 'Samarium (Sm, 62) is a lanthanide, used in magnets and nuclear reactors.' },
            { num: 63, sym: 'Eu', name: 'Europium', cat: 'lanthanide', pos: [8,8], info_young: 'Red in TV screens!', info_older: 'Europium (Eu, 63) is a lanthanide, used for red phosphors in screens.' },
            { num: 64, sym: 'Gd', name: 'Gadolinium', cat: 'lanthanide', pos: [8,9], info_young: 'MRI contrast agent.', info_older: 'Gadolinium (Gd, 64) is a lanthanide, used in MRI contrast agents.' },
            { num: 65, sym: 'Tb', name: 'Terbium', cat: 'lanthanide', pos: [8,10], info_young: 'Green in screens!', info_older: 'Terbium (Tb, 65) is a lanthanide, used for green phosphors.' },
            { num: 66, sym: 'Dy', name: 'Dysprosium', cat: 'lanthanide', pos: [8,11], info_young: 'Lanthanide group.', info_older: 'Dysprosium (Dy, 66) is a lanthanide, used in magnets and lasers.' },
            { num: 67, sym: 'Ho', name: 'Holmium', cat: 'lanthanide', pos: [8,12], info_young: 'Lanthanide group.', info_older: 'Holmium (Ho, 67) is a lanthanide with strong magnetic properties.' },
            { num: 68, sym: 'Er', name: 'Erbium', cat: 'lanthanide', pos: [8,13], info_young: 'Pink glass! Lasers.', info_older: 'Erbium (Er, 68) is a lanthanide, used in lasers and to color glass pink.' },
            { num: 69, sym: 'Tm', name: 'Thulium', cat: 'lanthanide', pos: [8,14], info_young: 'Rarest stable lanthanide.', info_older: 'Thulium (Tm, 69) is a lanthanide, the rarest stable one, used in portable X-ray devices.' },
            { num: 70, sym: 'Yb', name: 'Ytterbium', cat: 'lanthanide', pos: [8,15], info_young: 'Lanthanide group.', info_older: 'Ytterbium (Yb, 70) is a lanthanide, used in lasers and stainless steel.' },
            { num: 71, sym: 'Lu', name: 'Lutetium', cat: 'lanthanide', pos: [8,16], info_young: 'Last lanthanide.', info_older: 'Lutetium (Lu, 71) is the last lanthanide, dense and corrosion-resistant.' },
            { num: 72, sym: 'Hf', name: 'Hafnium', cat: 'transition-metal', pos: [6,4], info_young: 'Like Zirconium.', info_older: 'Hafnium (Hf, 72) is a transition metal similar to zirconium, used in nuclear control rods.' },
            { num: 73, sym: 'Ta', name: 'Tantalum', cat: 'transition-metal', pos: [6,5], info_young: 'Resists corrosion.', info_older: 'Tantalum (Ta, 73) is a transition metal, very corrosion-resistant, used in electronics.' },
            { num: 74, sym: 'W', name: 'Tungsten', cat: 'transition-metal', pos: [6,6], info_young: 'Light bulb filaments!', info_older: 'Tungsten (W, 74) is a transition metal with a very high melting point, used in filaments.' },
            { num: 75, sym: 'Re', name: 'Rhenium', cat: 'transition-metal', pos: [6,7], info_young: 'Very rare metal.', info_older: 'Rhenium (Re, 75) is a rare, dense transition metal used in jet engine alloys.' },
            { num: 76, sym: 'Os', name: 'Osmium', cat: 'transition-metal', pos: [6,8], info_young: 'Densest element!', info_older: 'Osmium (Os, 76) is a transition metal, the densest naturally occurring element.' },
            { num: 77, sym: 'Ir', name: 'Iridium', cat: 'transition-metal', pos: [6,9], info_young: 'From meteorites!', info_older: 'Iridium (Ir, 77) is a dense, corrosion-resistant transition metal, found in meteorites.' },
            { num: 78, sym: 'Pt', name: 'Platinum', cat: 'transition-metal', pos: [6,10], info_young: 'Expensive jewelry!', info_older: 'Platinum (Pt, 78) is a precious transition metal, used in jewelry and catalysts.' },
            { num: 79, sym: 'Au', name: 'Gold', cat: 'transition-metal', pos: [6,11], info_young: 'Shiny gold!', info_older: 'Gold (Au, 79) is a precious transition metal, highly valued for jewelry and currency.' },
            { num: 80, sym: 'Hg', name: 'Mercury', cat: 'transition-metal', pos: [6,12], info_young: 'Liquid metal!', info_older: 'Mercury (Hg, 80) is a transition metal, liquid at room temperature, used in thermometers.' },
            { num: 81, sym: 'Tl', name: 'Thallium', cat: 'post-transition-metal', pos: [6,13], info_young: 'Soft, toxic metal.', info_older: 'Thallium (Tl, 81) is a soft, toxic post-transition metal.' },
            { num: 82, sym: 'Pb', name: 'Lead', cat: 'post-transition-metal', pos: [6,14], info_young: 'Heavy metal, careful!', info_older: 'Lead (Pb, 82) is a dense, toxic post-transition metal, formerly used in pipes and paint.' },
            { num: 83, sym: 'Bi', name: 'Bismuth', cat: 'post-transition-metal', pos: [6,15], info_young: 'In Pepto-Bismol!', info_older: 'Bismuth (Bi, 83) is a post-transition metal used in medicines and low-melting alloys.' },
            { num: 84, sym: 'Po', name: 'Polonium', cat: 'post-transition-metal', pos: [6,16], info_young: 'Very radioactive!', info_older: 'Polonium (Po, 84) is a highly radioactive post-transition metal.' },
            { num: 85, sym: 'At', name: 'Astatine', cat: 'halogen', pos: [6,17], info_young: 'Rarest natural element!', info_older: 'Astatine (At, 85) is a highly radioactive halogen, the rarest naturally occurring element.' },
            { num: 86, sym: 'Rn', name: 'Radon', cat: 'noble-gas', pos: [6,18], info_young: 'Radioactive gas.', info_older: 'Radon (Rn, 86) is a radioactive noble gas, a health concern in some areas.' },
            { num: 87, sym: 'Fr', name: 'Francium', cat: 'alkali-metal', pos: [7,1], info_young: 'Extremely rare!', info_older: 'Francium (Fr, 87) is a highly radioactive alkali metal, extremely rare.' },
            { num: 88, sym: 'Ra', name: 'Radium', cat: 'alkaline-earth-metal', pos: [7,2], info_young: 'Glows in the dark (old use).', info_older: 'Radium (Ra, 88) is a radioactive alkaline earth metal, formerly used in luminous paints.' },
            { num: 89, sym: 'Ac', name: 'Actinium', cat: 'actinide', pos: [7,3], info_young: 'Starts another special series!', info_older: 'Actinium (Ac, 89) is the first element of the actinide series, highly radioactive.' },
            { num: 90, sym: 'Th', name: 'Thorium', cat: 'actinide', pos: [9,3], info_young: 'Radioactive, nuclear fuel?', info_older: 'Thorium (Th, 90) is a radioactive actinide, considered for nuclear fuel.' },
            { num: 91, sym: 'Pa', name: 'Protactinium', cat: 'actinide', pos: [9,4], info_young: 'Radioactive actinide.', info_older: 'Protactinium (Pa, 91) is a scarce, highly radioactive actinide.' },
            { num: 92, sym: 'U', name: 'Uranium', cat: 'actinide', pos: [9,5], info_young: 'Nuclear power!', info_older: 'Uranium (U, 92) is a radioactive actinide, the primary fuel for nuclear reactors.' },
            { num: 93, sym: 'Np', name: 'Neptunium', cat: 'actinide', pos: [9,6], info_young: 'First transuranium element.', info_older: 'Neptunium (Np, 93) is a radioactive actinide, the first synthetic transuranium element.' },
            { num: 94, sym: 'Pu', name: 'Plutonium', cat: 'actinide', pos: [9,7], info_young: 'Nuclear fuel & weapons.', info_older: 'Plutonium (Pu, 94) is a radioactive actinide, used in nuclear weapons and fuel.' },
            { num: 95, sym: 'Am', name: 'Americium', cat: 'actinide', pos: [9,8], info_young: 'In smoke detectors!', info_older: 'Americium (Am, 95) is a radioactive actinide, used in smoke detectors.' },
            { num: 96, sym: 'Cm', name: 'Curium', cat: 'actinide', pos: [9,9], info_young: 'Named after Curies.', info_older: 'Curium (Cm, 96) is a radioactive actinide, named after Marie and Pierre Curie.' },
            { num: 97, sym: 'Bk', name: 'Berkelium', cat: 'actinide', pos: [9,10], info_young: 'Named after Berkeley.', info_older: 'Berkelium (Bk, 97) is a radioactive actinide, named after Berkeley, California.' },
            { num: 98, sym: 'Cf', name: 'Californium', cat: 'actinide', pos: [9,11], info_young: 'Named after California.', info_older: 'Californium (Cf, 98) is a radioactive actinide, a strong neutron emitter.' },
            { num: 99, sym: 'Es', name: 'Einsteinium', cat: 'actinide', pos: [9,12], info_young: 'Named after Einstein!', info_older: 'Einsteinium (Es, 99) is a radioactive actinide, named after Albert Einstein.' },
            { num: 100, sym: 'Fm', name: 'Fermium', cat: 'actinide', pos: [9,13], info_young: 'Named after Fermi.', info_older: 'Fermium (Fm, 100) is a radioactive actinide, named after Enrico Fermi.' },
            { num: 101, sym: 'Md', name: 'Mendelevium', cat: 'actinide', pos: [9,14], info_young: 'Named after Mendeleev!', info_older: 'Mendelevium (Md, 101) is a radioactive actinide, named after Dmitri Mendeleev.' },
            { num: 102, sym: 'No', name: 'Nobelium', cat: 'actinide', pos: [9,15], info_young: 'Named after Nobel.', info_older: 'Nobelium (No, 102) is a radioactive actinide, named after Alfred Nobel.' },
            { num: 103, sym: 'Lr', name: 'Lawrencium', cat: 'actinide', pos: [9,16], info_young: 'Last actinide.', info_older: 'Lawrencium (Lr, 103) is a radioactive actinide, the last of the series.' },
            { num: 104, sym: 'Rf', name: 'Rutherfordium', cat: 'transition-metal', pos: [7,4], info_young: 'Superheavy element.', info_older: 'Rutherfordium (Rf, 104) is a synthetic radioactive transition metal.' },
            { num: 105, sym: 'Db', name: 'Dubnium', cat: 'transition-metal', pos: [7,5], info_young: 'Superheavy element.', info_older: 'Dubnium (Db, 105) is a synthetic radioactive transition metal.' },
            { num: 106, sym: 'Sg', name: 'Seaborgium', cat: 'transition-metal', pos: [7,6], info_young: 'Superheavy element.', info_older: 'Seaborgium (Sg, 106) is a synthetic radioactive transition metal.' },
            { num: 107, sym: 'Bh', name: 'Bohrium', cat: 'transition-metal', pos: [7,7], info_young: 'Superheavy element.', info_older: 'Bohrium (Bh, 107) is a synthetic radioactive transition metal.' },
            { num: 108, sym: 'Hs', name: 'Hassium', cat: 'transition-metal', pos: [7,8], info_young: 'Superheavy element.', info_older: 'Hassium (Hs, 108) is a synthetic radioactive transition metal.' },
            { num: 109, sym: 'Mt', name: 'Meitnerium', cat: 'transition-metal', pos: [7,9], info_young: 'Superheavy element.', info_older: 'Meitnerium (Mt, 109) is a synthetic radioactive transition metal, properties unknown.' },
            { num: 110, sym: 'Ds', name: 'Darmstadtium', cat: 'transition-metal', pos: [7,10], info_young: 'Superheavy element.', info_older: 'Darmstadtium (Ds, 110) is a synthetic radioactive transition metal, properties unknown.' },
            { num: 111, sym: 'Rg', name: 'Roentgenium', cat: 'transition-metal', pos: [7,11], info_young: 'Superheavy element.', info_older: 'Roentgenium (Rg, 111) is a synthetic radioactive transition metal, properties unknown.' },
            { num: 112, sym: 'Cn', name: 'Copernicium', cat: 'transition-metal', pos: [7,12], info_young: 'Superheavy element.', info_older: 'Copernicium (Cn, 112) is a synthetic radioactive transition metal, properties unknown.' },
            { num: 113, sym: 'Nh', name: 'Nihonium', cat: 'post-transition-metal', pos: [7,13], info_young: 'Superheavy element.', info_older: 'Nihonium (Nh, 113) is a synthetic radioactive element, properties unknown (likely post-transition metal).' },
            { num: 114, sym: 'Fl', name: 'Flerovium', cat: 'post-transition-metal', pos: [7,14], info_young: 'Superheavy element.', info_older: 'Flerovium (Fl, 114) is a synthetic radioactive element, properties unknown (likely post-transition metal).' },
            { num: 115, sym: 'Mc', name: 'Moscovium', cat: 'post-transition-metal', pos: [7,15], info_young: 'Superheavy element.', info_older: 'Moscovium (Mc, 115) is a synthetic radioactive element, properties unknown (likely post-transition metal).' },
            { num: 116, sym: 'Lv', name: 'Livermorium', cat: 'post-transition-metal', pos: [7,16], info_young: 'Superheavy element.', info_older: 'Livermorium (Lv, 116) is a synthetic radioactive element, properties unknown (likely post-transition metal).' },
            { num: 117, sym: 'Ts', name: 'Tennessine', cat: 'halogen', pos: [7,17], info_young: 'Superheavy element.', info_older: 'Tennessine (Ts, 117) is a synthetic radioactive element, properties unknown (likely halogen).' },
            { num: 118, sym: 'Og', name: 'Oganesson', cat: 'noble-gas', pos: [7,18], info_young: 'Heaviest element!', info_older: 'Oganesson (Og, 118) is a synthetic radioactive element, properties unknown (likely noble gas).' }
        ];
        
        // --- EXPANDED simpleReactions Object ---
        const simpleReactions = { /* The full expanded simpleReactions object from the previous turn should be pasted here */
            // --- Alloys ---
            "Cu_Zn": { name: "Brass", formula: "(Alloy of Cu & Zn)", info: "Brass is a versatile alloy...", examples: "Musical instruments..." },
            "Cu_Sn": { name: "Bronze", formula: "(Alloy of Cu & Sn)", info: "Bronze is an alloy consisting primarily of copper...", examples: "Sculptures, medals..." },
            "C_Fe": { name: "Steel", formula: "(Iron-Carbon Alloy)", info: "Steel is an alloy of iron and carbon...", examples: "Construction..." },
            "Ag_Hg": { name: "Dental Amalgam", formula: "(Alloy, e.g., Ag₂Hg₃)", info: "Dental amalgam is an alloy of mercury with various metals...", examples: "Fillings for dental cavities..." },
            "Al_Cu": { name: "Aluminum-Copper Alloy", formula: "(e.g., Duralumin type)", info: "Aluminum-copper alloys are known for their high strength...", examples: "Aircraft structures..." },
            // --- Oxides (Metal + Oxygen) ---
            "H_O": { name: "Water", formula: "H₂O", info: "Water is essential for all known forms of life...", examples: "Drinking, cooking..." },
            "Al_O": { name: "Aluminum Oxide", formula: "Al₂O₃", info: "Aluminum oxide is a hard, corrosion-resistant ceramic...", examples: "Production of aluminum metal..." },
            "Ba_O": { name: "Barium Oxide", formula: "BaO", info: "Barium oxide is a white, hygroscopic solid...", examples: "Coating for hot cathodes..." },
            "Ca_O": { name: "Calcium Oxide (Quicklime)", formula: "CaO", info: "Calcium oxide, commonly known as quicklime...", examples: "Steel manufacturing..." },
            "Cu_O": { name: "Copper(II) Oxide", formula: "CuO", info: "Copper(II) oxide or cupric oxide is the higher oxide of copper...", examples: "Pigment in ceramics..." },
            "Fe_O": { name: "Iron(III) Oxide (Rust)", formula: "Fe₂O₃", info: "Commonly known as rust, Iron(III) oxide is formed...", examples: "The reddish-brown coating on rusted iron..." },
            "K_O": { name: "Potassium Oxide", formula: "K₂O", info: "Potassium oxide is an ionic compound...", examples: "Component in some fertilizers..." },
            "Li_O": { name: "Lithium Oxide", formula: "Li₂O", info: "Lithium oxide is a white solid...", examples: "Ceramic glazes..." },
            "Mg_O": { name: "Magnesium Oxide", formula: "MgO", info: "Magnesium oxide, or magnesia, is a white hygroscopic solid...", examples: "Refractory material..." },
            "Ag_O": { name: "Silver(I) Oxide", formula: "Ag₂O", info: "Silver(I) oxide is a fine black or dark brown powder...", examples: "In silver-oxide batteries..." },
            "O_Pb": { name: "Lead(II) Oxide", formula: "PbO", info: "Lead(II) oxide, also known as litharge...", examples: "Component in lead-acid batteries..." },
            "O_Sn": { name: "Tin(IV) Oxide (Stannic Oxide)", formula: "SnO₂", info: "Tin(IV) oxide, also known as stannic oxide...", examples: "Gas sensors..." },
            "O_Zn": { name: "Zinc Oxide", formula: "ZnO", info: "Zinc oxide is a white powder...", examples: "Sunscreen and skin protectants..." },
            // --- Oxides (Non-metal + Oxygen) ---
            "C_O": { name: "Carbon Dioxide", formula: "CO₂", info: "Carbon dioxide is a colorless gas vital to life...", examples: "Carbonation of drinks..." },
            "N_O": { name: "Nitrogen Dioxide / Nitric Oxide", formula: "NO₂ / NO", info: "Nitrogen forms several oxides...", examples: "NO₂: Air pollutant..." },
            "O_P": { name: "Phosphorus Pentoxide", formula: "P₄O₁₀ (or P₂O₅)", info: "Phosphorus pentoxide is a white crystalline solid...", examples: "Drying agent..." },
            "O_S": { name: "Sulfur Dioxide", formula: "SO₂", info: "Sulfur dioxide is a toxic gas...", examples: "Preservative for dried fruits..." },
            "O_Si": { name: "Silicon Dioxide (Silica)", formula: "SiO₂", info: "Silicon dioxide, also known as silica...", examples: "Glass manufacturing..." },
            // --- Halides (Metal/Non-metal + Halogen) ---
            "Cl_Na": { name: "Sodium Chloride (Table Salt)", formula: "NaCl", info: "Commonly known as salt...", examples: "Seasoning food..." },
            "Al_Cl": { name: "Aluminum Chloride", formula: "AlCl₃", info: "Aluminum chloride is a white crystalline solid...", examples: "Catalyst in Friedel-Crafts reactions..." },
            "Ca_Cl": { name: "Calcium Chloride", formula: "CaCl₂", info: "Calcium chloride is an ionic compound...", examples: "De-icing roads..." },
            "Cl_H": { name: "Hydrogen Chloride", formula: "HCl", info: "Hydrogen chloride is a diatomic molecule...", examples: "Production of PVC plastic..." },
            "Cl_K": { name: "Potassium Chloride", formula: "KCl", info: "Potassium chloride is a metal halide salt...", examples: "Fertilizer..." },
            "Cl_Mg": { name: "Magnesium Chloride", formula: "MgCl₂", info: "Magnesium chloride is the name for the chemical compounds...", examples: "De-icing..." },
            "F_H": { name: "Hydrogen Fluoride", formula: "HF", info: "Hydrogen fluoride is a chemical compound that is a highly dangerous gas...", examples: "Production of fluorocarbons..." },
            "Fe_Cl": { name: "Iron(III) Chloride (Ferric Chloride)", formula: "FeCl₃", info: "Iron(III) chloride, also called ferric chloride...", examples: "Water treatment..." },
            "I_K": { name: "Potassium Iodide", formula: "KI", info: "Potassium iodide is an inorganic compound...", examples: "Dietary supplement..." },
            "Ag_Cl": { name: "Silver Chloride", formula: "AgCl", info: "Silver chloride is a chemical compound...", examples: "Photographic emulsions..." },
            "Br_H": { name: "Hydrogen Bromide", formula: "HBr", info: "Hydrogen bromide is a diatomic molecule...", examples: "Production of inorganic bromides..." },
            "Br_Na": { name: "Sodium Bromide", formula: "NaBr", info: "Sodium bromide is an inorganic compound...", examples: "Sedative and anticonvulsant..." },
            "H_I": { name: "Hydrogen Iodide", formula: "HI", info: "Hydrogen iodide is a diatomic molecule...", examples: "Reducing agent..." },
            // --- Sulfides (Metal/Non-metal + Sulfur) ---
            "Ag_S": { name: "Silver Sulfide (Tarnish)", formula: "Ag₂S", info: "Silver sulfide is an inorganic compound...", examples: "The black tarnish on silver objects..." },
            "Cu_S": { name: "Copper(I) Sulfide (Chalcocite)", formula: "Cu₂S", info: "Copper(I) sulfide is a copper-rich sulfide mineral...", examples: "Major ore of copper..." },
            "Fe_S": { name: "Iron(II) Sulfide (Pyrrhotite/Troilite)", formula: "FeS", info: "Iron(II) sulfide is one of a family of chemical compounds...", examples: "Laboratory source of hydrogen sulfide..." },
            "H_S": { name: "Hydrogen Sulfide", formula: "H₂S", info: "Hydrogen sulfide is a colorless, flammable, and extremely hazardous gas...", examples: "Chemical reagent..." },
            "Pb_S": { name: "Lead(II) Sulfide (Galena)", formula: "PbS", info: "Lead(II) sulfide is an inorganic compound...", examples: "Primary ore of lead..." },
            "S_Zn": { name: "Zinc Sulfide", formula: "ZnS", info: "Zinc sulfide is an inorganic compound...", examples: "Pigment (lithopone)..." },
            // --- Nitrides (Metal/Non-metal + Nitrogen) ---
            "Al_N": { name: "Aluminum Nitride", formula: "AlN", info: "Aluminum nitride is a solid nitride of aluminum...", examples: "Heat sinks in electronics..." },
            "B_N": { name: "Boron Nitride", formula: "BN", info: "Boron nitride exists in various crystalline forms...", examples: "h-BN: Lubricant..." },
            "Mg_N": { name: "Magnesium Nitride", formula: "Mg₃N₂", info: "Magnesium nitride is an inorganic compound...", examples: "Catalyst..." },
            "H_N": { name: "Ammonia", formula: "NH₃", info: "Ammonia is a colorless gas...", examples: "Fertilizer production..." },
            // --- Carbides ---
            "C_Ca": { name: "Calcium Carbide", formula: "CaC₂", info: "Calcium carbide is a chemical compound...", examples: "Production of acetylene gas..." }, // Note: Key sorted to C_Ca
            "C_Si": { name: "Silicon Carbide (Carborundum)", formula: "SiC", info: "Silicon carbide, also known as carborundum...", examples: "Abrasives..." },
            "C_H": { name: "Methane", formula: "CH₄", info: "Methane is a chemical compound...", examples: "Primary component of natural gas..." },
            // --- Diatomic Elemental Gases/Substances ---
            "H_H": { name: "Hydrogen Gas", formula: "H₂", info: "Hydrogen gas is a colorless, odorless...", examples: "Fuel for rockets..." },
            "N_N": { name: "Nitrogen Gas", formula: "N₂", info: "Nitrogen gas is a colorless, odorless diatomic gas...", examples: "Major component of air..." },
            "O_O": { name: "Oxygen Gas", formula: "O₂", info: "Oxygen gas is a colorless, odorless, and tasteless diatomic gas...", examples: "Respiration..." },
            "F_F": { name: "Fluorine Gas", formula: "F₂", info: "Fluorine is a pale yellow-green diatomic gas...", examples: "Production of uranium hexafluoride..." },
            "Cl_Cl": { name: "Chlorine Gas", formula: "Cl₂", info: "Chlorine is a greenish-yellow diatomic gas...", examples: "Water disinfection..." },
            "Br_Br": { name: "Bromine", formula: "Br₂", info: "Bromine is a fuming red-brown liquid...", examples: "Flame retardants..." },
            "I_I": { name: "Iodine", formula: "I₂", info: "Iodine is a lustrous, purple-black nonmetallic solid...", examples: "Antiseptic..." }
        };

        // --- Quiz Data ---
        const quizzes = {
            young: [ 
                { question: "पानी का रासायनिक प्रतीक क्या है?", options: ["O₂", "H₂O", "CO₂", "NaCl"], answer: "H₂O" },
                { question: "कौन सा तत्व गुब्बारों में हवा भरने के काम आता है जिससे वे उड़ते हैं?", options: ["ऑक्सीजन", "हीलियम", "नाइट्रोजन", "कार्बन"], answer: "हीलियम" },
                { question: "टेबल नमक का रासायनिक नाम क्या है?", options: ["पानी", "चीनी", "सोडियम क्लोराइड", "हाइड्रोजन"], answer: "सोडियम क्लोराइड" },
                { question: "'Fe' किस तत्व का प्रतीक है?", options: ["सोना (Gold)", "चांदी (Silver)", "लोहा (Iron)", "तांबा (Copper)"], answer: "लोहा (Iron)" },
                { question: "हम सांस लेने के लिए किस गैस का उपयोग करते हैं?", options: ["कार्बन डाइऑक्साइड", "हीलियम", "ऑक्सीजन", "नाइट्रोजन"], answer: "ऑक्सीजन" }
            ],
            intermediate: [ 
                { question: "कार्बन का परमाणु क्रमांक (Atomic Number) क्या है?", options: ["8", "12", "6", "14"], answer: "6" },
                { question: "निम्नलिखित में से कौन एक क्षार धातु (Alkali Metal) है?", options: ["कैल्शियम (Ca)", "सोडियम (Na)", "एल्युमिनियम (Al)", "आयरन (Fe)"], answer: "सोडियम (Na)" },
                { question: "H₂SO₄ किसका रासायनिक सूत्र है?", options: ["नमक", "सल्फ्यूरिक एसिड", "पानी", "अमोनिया"], answer: "सल्फ्यूरिक एसिड" },
                { question: "पीरियोडिक टेबल में ग्रुप 18 के तत्वों को क्या कहा जाता है?", options: ["हैलोजन", "क्षार धातु", "नोबल गैस", " संक्रमण धातु"], answer: "नोबल गैस" },
                { question: "जब लोहा (Iron) ऑक्सीजन और नमी के संपर्क में आता है तो क्या बनता है?", options: ["स्टील", "जंग (Rust)", "कांसा", "पीतल"], answer: "जंग (Rust)" }
            ],
            older: [ 
                { question: "कौन सा कण एक परमाणु के नाभिक (Nucleus) में नहीं पाया जाता है?", options: ["प्रोटॉन", "न्यूट्रॉन", "इलेक्ट्रॉन", "ये सभी नाभिक में होते हैं"], answer: "इलेक्ट्रॉन" },
                { question: "निम्नलिखित में से कौन सबसे अधिक प्रतिक्रियाशील (Reactive) धातु है?", options: ["सोना (Au)", "पोटेशियम (K)", "तांबा (Cu)", "लोहा (Fe)"], answer: "पोटेशियम (K)" },
                { question: "pH < 7 वाले घोल की प्रकृति क्या होती है?", options: ["अम्लीय (Acidic)", "क्षारीय (Basic/Alkaline)", "तटस्थ (Neutral)", "इनमें से कोई नहीं"], answer: "अम्लीय (Acidic)" },
                { question: "कार्बन के अपरूप (Allotropes) कौन से हैं?", options: ["हीरा और ग्रेफाइट", "ऑक्सीजन और ओजोन", "पानी और बर्फ", "लोहा और स्टील"], answer: "हीरा और ग्रेफाइट" },
                { question: "हाइड्रोजन और ऑक्सीजन की प्रतिक्रिया से पानी बनने पर किस प्रकार की ऊर्जा निकलती है?", options: ["प्रकाश ऊर्जा", "ऊष्मा ऊर्जा (Heat Energy)", "विद्युत ऊर्जा", "ध्वनि ऊर्जा"], answer: "ऊष्मा ऊर्जा (Heat Energy)" }
            ]
        };


        // --- Periodic Table Functions ---
        function displayPeriodicTable() { 
            periodicTableGrid.innerHTML = ''; 
            let maxRow = 0, maxCol = 0;
            if (!elementsData || elementsData.length < 118) { // Ensure we have all elements
                periodicTableGrid.innerHTML = "<p style='color:red; font-size:1.2em;'>Error: Full 'elementsData' array with 118 elements is missing or incomplete.</p>";
                return;
            }
            elementsData.forEach(el => {
                if (el.pos[0] > maxRow) maxRow = el.pos[0];
                if (el.pos[1] > maxCol) maxCol = el.pos[1];
            });
            if (maxCol < 18) maxCol = 18;

            const grid = Array(maxRow).fill(null).map(() => Array(maxCol).fill(null));
            elementsData.forEach(el => {
                if (el.pos[0] > 0 && el.pos[1] > 0) grid[el.pos[0]-1][el.pos[1]-1] = el;
            });
            
            for (let r = 0; r < maxRow; r++) { 
                 if (r === 7 && grid[r].some(el => el && el.cat === 'lanthanide')) {
                    const labelDiv = document.createElement('div'); labelDiv.classList.add('series-label');
                    labelDiv.style.gridColumnStart = 1; labelDiv.style.gridColumnEnd = 3;
                    labelDiv.textContent = 'Lanthanides →'; periodicTableGrid.appendChild(labelDiv);
                }
                if (r === 8 && grid[r].some(el => el && el.cat === 'actinide')) {
                    const labelDiv = document.createElement('div'); labelDiv.classList.add('series-label');
                    labelDiv.style.gridColumnStart = 1; labelDiv.style.gridColumnEnd = 3;
                    labelDiv.textContent = 'Actinides →'; periodicTableGrid.appendChild(labelDiv);
                }

                for (let c = 0; c < maxCol; c++) {
                    if ((r === 7 && c < 2 && grid[r].some(el => el && el.cat === 'lanthanide')) || 
                        (r === 8 && c < 2 && grid[r].some(el => el && el.cat === 'actinide')) ) {
                        if (c < 2) continue; 
                    }
                    const elementData = grid[r][c];
                    if (elementData) {
                        const elementDiv = document.createElement('div');
                        elementDiv.classList.add('element', elementData.cat);
                        elementDiv.innerHTML = `<div class="atomic-number">${elementData.num}</div><div class="symbol">${elementData.sym}</div><div class="name">${elementData.name}</div>`;
                        elementDiv.addEventListener('click', () => showElementDetails(elementData));
                        periodicTableGrid.appendChild(elementDiv);
                    } else {
                        const emptyDiv = document.createElement('div'); emptyDiv.classList.add('empty-cell'); periodicTableGrid.appendChild(emptyDiv);
                    }
                }
            }
        }

        function showElementDetails(element) { 
            let info = '';
            if (currentUser.age <= 10) info = element.info_young || `Learn more about ${element.name}!`;
            else if (currentUser.age <= 15) {
                info = element.info_older || `A fascinating element: ${element.name}.`;
                if (element.info_young && element.info_young !== element.info_older) info = `<b>Fun Fact:</b> ${element.info_young}<br><br>${info}`;
            } else {
                info = element.info_older || `Details for ${element.name} (${element.sym}).`;
                info += `<br><br><b>Atomic Number:</b> ${element.num}<br><b>Symbol:</b> ${element.sym}<br><b>Category:</b> ${element.cat.replace('-', ' ')}`;
            }
            elementDetailsContent.innerHTML = `<h3>${element.name} (${element.sym})</h3><p><strong>Atomic Number:</strong> ${element.num}</p><p>${info}</p><p style="font-size:0.9em; opacity:0.8;">(Element info for ${currentUser.name}, age ${currentUser.age})</p>`;
            elementModal.style.display = 'flex';
        }

        // --- Reaction Playground Functions ---
        function populatePlaygroundElements() { 
            playgroundElementsContainer.innerHTML = '<h3>Tap to Select Element</h3>'; 
            if (!elementsData || elementsData.length === 0) {
                 console.error("elementsData is empty or not loaded for playground.");
                 playgroundElementsContainer.innerHTML += "<p style='color:red'>Error loading elements.</p>";
                 return;
            }
            elementsData.forEach(elData => {
                const elDiv = document.createElement('div');
                elDiv.classList.add('draggable-element', elData.cat);
                elDiv.dataset.symbol = elData.sym;
                elDiv.innerHTML = `<div class="symbol">${elData.sym}</div><div class="name">${elData.name}</div>`;
                
                elDiv.addEventListener('click', () => {
                    if (currentlySelectedVisualElement === elDiv) {
                        elDiv.classList.remove('selected-for-reaction');
                        selectedPlaygroundElementData = null;
                        currentlySelectedVisualElement = null;
                        updateDropZoneHighlights(false);
                    } else {
                        if (currentlySelectedVisualElement) {
                            currentlySelectedVisualElement.classList.remove('selected-for-reaction');
                        }
                        elDiv.classList.add('selected-for-reaction');
                        selectedPlaygroundElementData = elData;
                        currentlySelectedVisualElement = elDiv;
                        updateDropZoneHighlights(true);
                    }
                });

                elDiv.setAttribute('draggable', true);
                elDiv.addEventListener('dragstart', (e) => {
                    draggedElementDataForDesktop = elData;
                    if (e.dataTransfer) {
                        e.dataTransfer.setData('text/plain', elData.sym);
                    }
                    e.target.style.opacity = '0.5';
                    if (currentlySelectedVisualElement) currentlySelectedVisualElement.classList.remove('selected-for-reaction');
                    selectedPlaygroundElementData = null;
                    currentlySelectedVisualElement = null;
                    updateDropZoneHighlights(false);
                });
                elDiv.addEventListener('dragend', (e) => {
                    e.target.style.opacity = '1';
                    draggedElementDataForDesktop = null;
                });
                playgroundElementsContainer.appendChild(elDiv);
            });
        }
        function updateDropZoneHighlights(canPlace) { 
            [dropZone1, dropZone2].forEach(zone => {
                if (canPlace) zone.classList.add('can-place');
                else zone.classList.remove('can-place');
            });
        }
        function setupDropZoneInteractions(dropZone) { 
            dropZone.addEventListener('click', () => {
                if (selectedPlaygroundElementData) {
                    const elDataToPlace = selectedPlaygroundElementData;
                    const droppedElDiv = document.createElement('div');
                    droppedElDiv.classList.add('draggable-element', elDataToPlace.cat);
                    droppedElDiv.dataset.symbol = elDataToPlace.sym;
                    droppedElDiv.innerHTML = `<div class="symbol">${elDataToPlace.sym}</div><div class="name">${elDataToPlace.name}</div>`;
                    
                    dropZone.innerHTML = '';
                    dropZone.appendChild(droppedElDiv);
                    dropZone.dataset.elementSymbol = elDataToPlace.sym;

                    if (currentlySelectedVisualElement) {
                        currentlySelectedVisualElement.classList.remove('selected-for-reaction');
                    }
                    selectedPlaygroundElementData = null;
                    currentlySelectedVisualElement = null;
                    updateDropZoneHighlights(false);
                }
            });

            dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('drag-over'); });
            dropZone.addEventListener('dragleave', () => { dropZone.classList.remove('drag-over'); });
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                if (draggedElementDataForDesktop) {
                    const droppedElDiv = document.createElement('div');
                    droppedElDiv.classList.add('draggable-element', draggedElementDataForDesktop.cat);
                    droppedElDiv.dataset.symbol = draggedElementDataForDesktop.sym;
                    droppedElDiv.innerHTML = `<div class="symbol">${draggedElementDataForDesktop.sym}</div><div class="name">${draggedElementDataForDesktop.name}</div>`;
                    
                    dropZone.innerHTML = '';
                    dropZone.appendChild(droppedElDiv);
                    dropZone.dataset.elementSymbol = draggedElementDataForDesktop.sym;
                }
                draggedElementDataForDesktop = null;
            });
        }

        combineButton.addEventListener('click', () => { 
            const el1Symbol = dropZone1.dataset.elementSymbol;
            const el2Symbol = dropZone2.dataset.elementSymbol;
            reactionResultDiv.innerHTML = ''; 
            reactionResultDiv.className = 'reaction-result'; 

            if (el1Symbol && el2Symbol) {
                const key = [el1Symbol, el2Symbol].sort().join('_'); 
                const productData = simpleReactions[key];

                if (productData) {
                    const productDisplay = document.createElement('div');
                    
                    let productHtml = `Forms: <strong class="clickable-product">${productData.name}`;
                    if (productData.formula) {
                        productHtml += ` ${productData.formula}`;
                    }
                    productHtml += `</strong>!`;
                    
                    if (productData.info || productData.examples) {
                         productHtml += `<p>(Click product name for more details)</p>`; // Simpler hint
                    }
                    productDisplay.innerHTML = productHtml;

                    const clickablePart = productDisplay.querySelector('.clickable-product');
                    if (clickablePart && (productData.info || productData.examples)) {
                        clickablePart.addEventListener('click', () => {
                            elementDetailsContent.innerHTML = `<h3>${productData.name} ${productData.formula ? productData.formula : ''}</h3>
                                                               <p><strong>Information:</strong><br>${productData.info || 'No specific information available.'}</p>
                                                               <p><strong>Examples:</strong><br>${productData.examples || 'No specific examples available.'}</p>`;
                            elementModal.style.display = 'flex';
                        });
                    }
                    
                    reactionResultDiv.appendChild(productDisplay);
                    reactionResultDiv.classList.add('product-animation'); 

                    setTimeout(() => {
                        dropZone1.innerHTML = `<span class="element-placeholder">Zone 1</span>`;
                        dropZone2.innerHTML = `<span class="element-placeholder">Zone 2</span>`;
                        delete dropZone1.dataset.elementSymbol;
                        delete dropZone2.dataset.elementSymbol;
                    }, 2200); 
                } else {
                    reactionResultDiv.textContent = "No simple reaction defined for this pair.";
                    reactionResultDiv.classList.add('reaction-error');
                }
            } else {
                reactionResultDiv.textContent = "Drop two elements to combine.";
                 reactionResultDiv.classList.add('reaction-error');
            }
        });

        // --- Quiz Functions ---
        function selectQuizQuestionsByAge() {
            if (currentUser.age <= 10) return quizzes.young;
            if (currentUser.age <= 15) return quizzes.intermediate;
            return quizzes.older;
        }

        function shuffleArray(array) { 
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function prepareQuiz() {
            const ageAppropriateQuestions = selectQuizQuestionsByAge();
            currentQuizQuestions = shuffleArray([...ageAppropriateQuestions]).slice(0, QUESTIONS_PER_QUIZ);
            currentQuestionIndex = 0;
            currentScore = 0;
            scoreSpan.textContent = currentScore;
            quizGreetingDiv.textContent = `Hello ${currentUser.name}! Let's test your Chemistry knowledge.`;
            
            quizAreaDiv.classList.add('hidden');
            quizResultsAreaDiv.classList.add('hidden');
            startQuizButton.classList.remove('hidden');
            feedbackTextDiv.textContent = '';
            nextQuestionButton.classList.add('hidden');
        }

        function displayCurrentQuestion() {
            if (currentQuestionIndex < currentQuizQuestions.length) {
                const questionObj = currentQuizQuestions[currentQuestionIndex];
                questionTextP.textContent = questionObj.question;
                optionsContainerDiv.innerHTML = '';
                selectedOptionButton = null; 

                const shuffledOptions = shuffleArray([...questionObj.options]);

                shuffledOptions.forEach(option => {
                    const button = document.createElement('button');
                    button.classList.add('option-button');
                    button.textContent = option;
                    button.addEventListener('click', () => {
                        if (selectedOptionButton) {
                            selectedOptionButton.classList.remove('selected');
                        }
                        selectedOptionButton = button;
                        button.classList.add('selected');
                        submitAnswerButton.disabled = false; 
                    });
                    optionsContainerDiv.appendChild(button);
                });
                quizAreaDiv.classList.remove('hidden');
                startQuizButton.classList.add('hidden');
                submitAnswerButton.classList.remove('hidden');
                submitAnswerButton.disabled = true; 
                nextQuestionButton.classList.add('hidden');
                feedbackTextDiv.textContent = '';
            } else {
                showQuizResults();
            }
        }

        function handleSubmitAnswer() {
            if (!selectedOptionButton) return; 

            const questionObj = currentQuizQuestions[currentQuestionIndex];
            const userAnswer = selectedOptionButton.textContent;

            optionsContainerDiv.querySelectorAll('.option-button').forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === questionObj.answer) {
                    btn.classList.add('correct'); 
                }
            });


            if (userAnswer === questionObj.answer) {
                currentScore++;
                scoreSpan.textContent = currentScore;
                feedbackTextDiv.textContent = "Correct! 🎉";
                feedbackTextDiv.style.color = "#84fab0";
                selectedOptionButton.classList.add('correct');
            } else {
                feedbackTextDiv.textContent = `Incorrect. The correct answer is: ${questionObj.answer}`;
                feedbackTextDiv.style.color = "#ff6b6b";
                selectedOptionButton.classList.add('incorrect');
            }
            submitAnswerButton.classList.add('hidden');
            nextQuestionButton.classList.remove('hidden');
        }

        function handleNextQuestion() {
            optionsContainerDiv.querySelectorAll('.option-button').forEach(btn => btn.disabled = false);
            currentQuestionIndex++;
            displayCurrentQuestion();
        }

        function showQuizResults() {
            quizAreaDiv.classList.add('hidden');
            quizResultsAreaDiv.classList.remove('hidden');
            finalScoreSpan.textContent = currentScore;
            totalQuestionsAnsweredSpan.textContent = currentQuizQuestions.length;
        }
        
        // --- Event Listeners & Initial Setup ---
        startLearningButton.addEventListener('click', () => {
            const name = userNameInput.value.trim();
            const age = parseInt(userAgeInput.value);
            if (name && age > 0) {
                currentUser.name = name; currentUser.age = age;
                userProfileSection.classList.add('hidden');
                periodicTableSection.classList.remove('hidden');
                greetingDiv.textContent = `Hello ${currentUser.name}! Let's explore.`;
                if (periodicTableGrid.children.length === 0) displayPeriodicTable();
            } else {
                alert('Please enter your name and a valid age.');
            }
        });

        closeModalButton.addEventListener('click', () => { elementModal.style.display = 'none'; });
        window.addEventListener('click', (event) => { if (event.target === elementModal) elementModal.style.display = 'none'; });

        gotoPlaygroundButton.addEventListener('click', () => {
            periodicTableSection.classList.add('hidden');
            quizSection.classList.add('hidden');
            reactionPlaygroundSection.classList.remove('hidden');
            // Ensure playground elements are populated if not already or if incomplete
            if (playgroundElementsContainer.children.length <= 1 || 
               (playgroundElementsContainer.children.length > 1 && (playgroundElementsContainer.children.length -1) < elementsData.length) ) { 
                 populatePlaygroundElements();
            }
            if (currentlySelectedVisualElement) currentlySelectedVisualElement.classList.remove('selected-for-reaction');
            selectedPlaygroundElementData = null; currentlySelectedVisualElement = null;
            updateDropZoneHighlights(false);
            reactionResultDiv.innerHTML = '';
            dropZone1.innerHTML = `<span class="element-placeholder">Zone 1</span>`;
            dropZone2.innerHTML = `<span class="element-placeholder">Zone 2</span>`;
            delete dropZone1.dataset.elementSymbol; delete dropZone2.dataset.elementSymbol;
        });

        backToTableButton.addEventListener('click', () => {
            reactionPlaygroundSection.classList.add('hidden');
            quizSection.classList.add('hidden');
            periodicTableSection.classList.remove('hidden');
        });
        
        gotoQuizButton.addEventListener('click', () => {
            periodicTableSection.classList.add('hidden');
            reactionPlaygroundSection.classList.add('hidden');
            quizSection.classList.remove('hidden');
            prepareQuiz();
        });

        startQuizButton.addEventListener('click', displayCurrentQuestion);
        submitAnswerButton.addEventListener('click', handleSubmitAnswer);
        nextQuestionButton.addEventListener('click', handleNextQuestion);
        playAgainButton.addEventListener('click', prepareQuiz);

        backToMainFromQuizButton.addEventListener('click', () => {
            quizSection.classList.add('hidden');
            reactionPlaygroundSection.classList.add('hidden');
            periodicTableSection.classList.remove('hidden');
        });
        
        setupDropZoneInteractions(dropZone1);
        setupDropZoneInteractions(dropZone2);

    </script>
</body>
</html>
